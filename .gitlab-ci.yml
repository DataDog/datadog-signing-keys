---
include:
  - /.gitlab/build.yaml
  - /.gitlab/common.yaml
  - /.gitlab/upload.yaml
  - /.gitlab/promote_testing.yaml
  - /.gitlab/test.yaml
  - /.gitlab/promote.yaml

variables:
  #Do not change this - must be the repository name for Kubernetes runners to work
  KUBERNETES_SERVICE_ACCOUNT_OVERWRITE: "datadog-signing-keys"
  DATADOG_AGENT_BUILDIMAGES: v47979770-a5a4cfd0
  DD_PKG_VERSION: latest
  DESTINATION_DEB: datadog-signing-keys.deb
  OMNIBUS_BASE_DIR: /.omnibus
  OMNIBUS_PACKAGE_DIR: $CI_PROJECT_DIR/.omnibus/pkg/
  PACKAGE_VERSION_OVERRIDE: ""
  PIPELINE_KEY_ALIAS: "alias/ci_datadog-signing-keys_pipeline-key"
  PROJECT_NAME: datadog-signing-keys
  USR_SHARE_KEYRING: /usr/share/keyrings/datadog-archive-keyring.gpg
  DD_LIST_FILE: /etc/apt/sources.list.d/datadog.list
  OPW_LIST_FILE: /etc/apt/sources.list.d/datadog-observability-pipelines-worker.list
  # Fun note: if you use the same URL in 2 source files once with signed-by and
  # once without it, some older versions of APT segfault.
  SOURCE_SIGNED_BY: "deb [signed-by=${USR_SHARE_KEYRING}] http://notimportant x y"
  SOURCE_NO_SIGNED_BY: "deb http://reallynotimportant x y"
  INTERNAL_REGISTRY: 486234852809.dkr.ecr.us-east-1.amazonaws.com/ci

stages:
  - build
  - upload
  - promote_testing
  - test
  - promote
